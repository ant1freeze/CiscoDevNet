Задачей было нахождение свича/порта в режиме access, с которого приходит нужный нам мак адрес.
<br>В моей реализации мак адрес задается в файле input_mac и затем проверяется на валидность.
<br>Так как в задаче было условие, что топология может меняться, и неизвестно, знаем ли мы все ip адреса, я сделал конфигурацию файла hosts.yaml с помощью скрипта generate_hosts.py.
<br>Он генерирует hosts.yaml с содержимым такого вида:
---
sw1:
    hostname: 192.168.1.1
    groups:
        - switch
sw2:
    hostname: 192.168.1.2
    groups:
        - switch

К сожалению, скрипт отработает, только если все устройства будут cisco_ios (может быть другие cisco, если у них вывод команд такой же).Если же среди устройств будут другие (не свичи/свичи других вендоров), скрипт не отработает, так как проверку я не делал.

Логин/пароль хранится в defaults.yaml

Сам поиск мак адреса можно разделить на 2 части:
1) Определяем "живые" хосты с помощью пинга
2) Запускаем для них 2 команды: sh int sw и sh mac address-table

Вывод первой мы преобразовываем в словарь, где ключом является имя свича, а значением список всех портов этого свича, которые настроены в режиме access.

Вывод второй мы обрабатываем и ищем среди всех мак адресов на каждом свиче тот, который приходит с одного из порта, настроенного в режиме access.

Если все успешно, то выводим сообщение с указанием имени свича/ip свича/порта/влана.

PS.
Изначально я хотел реализовать эту задачу с помощью netbox+nornir.
Сперва занести все девайсы в netbox в статусе Offline, затем проверить доступность каждого девайса пингом и для "живых" поменять статус на Active.
Затем для всех девайсов запустить скрипт поиска мак адреса, аналогично вышеописанному.
Не вышло, так как я не смог вытащить из netbox'а в nornir статус оборудования (для этого надо править класс NBInventory, а с ООП я пока очень плохо знаком)
