Задачей было нахождение свича/порта в режиме access, с которого приходит нужный нам мак адрес.
<br>В моей реализации мак адрес задается в файле input_mac и затем проверяется на валидность.
<br>Так как в задаче было условие, что топология может меняться, и неизвестно, знаем ли мы все ip адреса, я сделал конфигурацию файла hosts.yaml с помощью скрипта generate_hosts.py.
<br>Он генерирует hosts.yaml с содержимым такого вида:
<br>---
<br>sw1:
    <br>hostname: 192.168.1.1
    <br>groups:
        <br>- switch
<br>sw2:
    <br>hostname: 192.168.1.2
    <br>groups:
        <br>- switch

<br>К сожалению, скрипт отработает, только если все устройства будут cisco_ios (может быть другие cisco, если у них вывод команд такой же).Если же среди устройств будут другие (не свичи/свичи других вендоров), скрипт не отработает, так как проверку я не делал.

<br>Логин/пароль хранится в defaults.yaml

<br>Сам поиск мак адреса можно разделить на 2 части:
<br>1) Определяем "живые" хосты с помощью пинга
<br>2) Запускаем для них 2 команды: sh int sw и sh mac address-table

<br><br>Вывод первой мы преобразовываем в словарь, где ключом является имя свича, а значением список всех портов этого свича, которые настроены в режиме access.

<br><br>Вывод второй мы обрабатываем и ищем среди всех мак адресов на каждом свиче тот, который приходит с одного из порта, настроенного в режиме access.

<br>Если все успешно, то выводим сообщение с указанием имени свича/ip свича/порта/влана.

<br>PS.
Изначально я хотел реализовать эту задачу с помощью netbox+nornir.
<br>Сперва занести все девайсы в netbox в статусе Offline (файл dev_to_nb.py и config_nb.yaml), затем проверить доступность каждого девайса пингом (а так же собрать факты для каждого устройства и дозанести их в netbox) и для "живых" поменять статус на Active.
<br>Затем для всех девайсов запустить скрипт поиска мак адреса, аналогично вышеописанному.
<br>Не вышло, так как я не смог вытащить из netbox'а в nornir статус оборудования (для этого надо править класс NBInventory, а с ООП я пока очень плохо знаком), а также не понял, как заполнять creds в netbox и вытаскивать их.
